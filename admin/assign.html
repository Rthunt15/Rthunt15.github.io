<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Secret Santa â€” Assign</title>
  <style>
    body{font-family:Inter,system-ui,Segoe UI,Roboto,Arial;background:#0f1724;color:#e6eef3;padding:28px}
    .panel{max-width:900px;margin:0 auto;background:rgba(255,255,255,0.02);padding:18px;border-radius:12px;border:1px solid rgba(255,255,255,0.03)}
    textarea{width:100%;min-height:160px;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:rgba(255,255,255,0.01);color:inherit}
    .row{display:flex;gap:12px;margin-top:12px}
    .btn{background:linear-gradient(90deg,#4fd1c5,#2b87a0);color:#032223;padding:10px 12px;border-radius:8px;border:0;cursor:pointer;font-weight:700}
    table{width:100%;margin-top:12px;border-collapse:collapse}
    th,td{padding:8px;border-bottom:1px solid rgba(255,255,255,0.03);text-align:left}
    a.link{color:#7fe8d9}
    .note{color:#9aa6b2;font-size:0.95rem}
  </style>
</head>
<body>
  <main class="panel">
    <h2>Assign Secret Santa Forms</h2>
    <p class="note">Paste one recipient name per line. The service will assign each recipient a submission file (ensuring no one gets their own). The returned links point to anonymized copies you can download/send. The server does not reveal who submitted which file in the UI.</p>

    <label for="recipients">Recipients (one per line)</label>
    <textarea id="recipients" placeholder="Alice\nBob\nCharlie"></textarea>

    <div class="row">
      <button id="run" class="btn">Create assignments</button>
      <button id="clear" class="btn" style="background:#223">Clear</button>
      <span id="status" style="margin-left:12px;color:#9aa6b2"></span>
    </div>

    <div id="result"></div>
  </main>

  <script>
    document.getElementById('run').addEventListener('click', async ()=>{
      const txt = document.getElementById('recipients').value.trim();
      if(!txt) return alert('Enter at least one recipient');
      const recipients = txt.split(/\r?\n/).map(s=>s.trim()).filter(Boolean);
      document.getElementById('status').textContent = 'Assigning...';
      try{
        const res = await fetch('/api/assign', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({recipients}) });
        const j = await res.json();
        if(!j.ok){ document.getElementById('status').textContent = 'Error: '+(j.error||'unknown'); return; }
        document.getElementById('status').textContent = 'Done';
        const container = document.getElementById('result');
        container.innerHTML = '';
        const table = document.createElement('table');
        const thead = document.createElement('thead');
        thead.innerHTML = '<tr><th>Recipient</th><th>Assigned file (click to download)</th></tr>';
        table.appendChild(thead);
        const tbody = document.createElement('tbody');
        for(const r of Object.keys(j.assignments)){
          const tr = document.createElement('tr');
          const td1 = document.createElement('td'); td1.textContent = r;
          const td2 = document.createElement('td');
          const a = document.createElement('a');
          a.href = j.assignments[r];
          a.textContent = j.assignments[r];
          a.className = 'link';
          a.target = '_blank';
          td2.appendChild(a);
          tr.appendChild(td1); tr.appendChild(td2);
          tbody.appendChild(tr);
        }
        table.appendChild(tbody);
        container.appendChild(table);
      }catch(err){
        console.error(err); document.getElementById('status').textContent = 'Network error';
      }
    });
    document.getElementById('clear').addEventListener('click', ()=>{ document.getElementById('recipients').value=''; document.getElementById('result').innerHTML=''; document.getElementById('status').textContent=''; });
  </script>
</body>
</html>
